@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
<div id="messages" class="border p-3 mb-3" style="height: 300px; overflow-y: scroll;"></div>


<script>
    const messagesDiv = document.getElementById("messages");
    const messageInput = document.getElementById("messageInput");
    const sendButton = document.getElementById("sendButton");

     $(document).ready(function() {
        connect();
     });
  

     function connect() {
        const socket = new WebSocket("wss://localhost:7054/ws/messages");

        socket.onopen = function () {
            console.log("Connexion WebSocket ouverte");
            setInterval(() => {
            if (socket.readyState === WebSocket.OPEN) {
                    socket.send('ping');
                }
            }, 10000);
        };

        

        socket.onmessage = function (event) {
            console.log("Reveive");
            const message = JSON.parse(event.data);
            const messageElement = document.createElement("div");
            messageElement.textContent = `${message.timestamp}: ${message.text}`;
            messagesDiv.appendChild(messageElement);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            return false;
        };

        socket.onclose = function (event) {
            console.log("Connexion WebSocket fermée", event);
           // setTimeout(connect, 1000);
        };

    }

</script>